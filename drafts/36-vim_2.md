Title: vims
Date: 2025-04-15T22:30:20
Category: NixOS

Font sorted! Where was I?

Getting rid of that warning. It looks like I have two options:

1. Install `web-devicons`
2. Install `mini`
    - Include the `icons` module
    - Include the `mockDevIcons` module

I'd never heard of [mini](https://github.com/echasnovski/mini.nvim) before, but it looks like a lovely way to maintain consistency. So I'm going to go for that to begin with.

It's a bit of a kitchen sink, so I'm not sure where to put it. Icons are a style thing, so it's time to expand the style config a bit.

First split it into it's own directory:

<!-- TODO Link to commit 001557c -->

Next, enable the mini "meta" plugin.

<!-- TODO Link to commit ff0e304 -->

Then enable the icons plugin

<!-- TODO Link to commit bf8c108 -->

Finally, turn on the devicons mock so that mini.icons "pretends" to be devicons for any plugins that expect that and don't support mini.icons.

<!-- TODO Link to commit 8b203aa -->

And the warning is gone ü•≥. And I'm going to have pretty icons when I configure Telescope.

## Telescope

Oh yeah! Telescope, that's what I was doing.

My most common usage for telescope is to find and open files:

<!-- TODO Link to commit ac47782 -->

Now if I run `Telescope find_files` in neovim I get this lovely view, and I can type to find the file I want. It's way faster than navigating a tree.

<!-- TODO Insert image 36-telescope_find_files.png -->

Double-press escape to get out of Telescope.

I have a regular key (`<leader> ff`) combination to bring up the `find_files` ui, so time to add that.

Oh, wait. I haven't configured my leader keys yet.

Leader keys are so you can configure lots of key combinations and shortcuts without worrying about clashing with any regular vim conbinations. The idea is that you have a key that preceeds any of your custom bindings, almost like you're putting vim into another mode (my-stuff-mode).

There's two leader keys; `<Leader>` and `<LocalLeader>`. The second one is local to a buffer, and I haven't yet found an excuse to use it.

The trick is to find a key that isn't useful for anything else. I used to use the `,` key, but `,` is incredibly useful for repeating things backwards (it's the opposite of [the dot key](https://neovim.io/doc/user/repeat.html#_single-repeats)).

The default key is `\`, which is _kind of_ OK on a US keyboard like mine, but if I need to use a UK keyboard as well it'll break my brain.

The `<space>` key does basically **nothing** though. It does the same as the `l` key, which is "move right one character. It's central, pressed by the strongest fingers on my hands, and accessible when I'm in the home position. It's _perfect_.

<!-- TODO Link to commit 1ef15a9 -->

(You don't _have_ to use a leader key by the way, I just like to make sure I don't step on any default bindings).

Now I can add a key combination to launch the find files fuzzy finder. I'm trying to use mnemonics, so `ff` is `find files`.

<!-- TODO Link to commit 408e030 -->

Vim doesn't do live-reloads by the way so I'm quitting and re-entering vim to get these changes to appear.

According to [telescope's README](https://github.com/nvim-telescope/telescope.nvim?tab=readme-ov-file#suggested-dependencies), it's recommended to install fzf-native or something as well.

<!-- TODO Link to commit 8d87c30 -->

Easy. Lets have a look at `checkhealth telescope` in vim and see if I need to do anything else.

There are three warnings/errors:

1. `nvim-treesitter` is not found (I will deal with this later)
2 .`rg` is not found.
3. `fd` is not found,

I've never used [fd](https://github.com/sharkdp/fd) before but it sounds kinda lovely.

[RipGrep (rg)](https://github.com/BurntSushi/ripgrep) is wonderful and I've missed it terribly. Time to get ripgrep on my system.

Ripgrep:

<!-- TODO Link to commit 91ad296 -->

Treat RipGrep like normal grep by running the `rg` command and providing a pattern. It prints filenames and line numbers by default, searchers recursively by default as well üòç, respects `.gitignore` as well. It **doesn't** follow symlinks by default which is a bit of a pain on NixOS.

And fd:

<!-- TODO Link to commit eff2558 -->

That looks really interesting and I need to play with it some more.

I can fix RipGrep ignoring symlinks with an alias though:

<!-- TODO Link to commit 0dc6687 -->

Back to telescope. What else can I search?

Search (grep) for text. Very very useful. The extension is already enabled somehow so I just need to add `<leader>fg` to call it.

<!-- TODO Link to commit 94d2404 -->

Normally I use `/` to search the current buffer, which makes sense because it's the obvious default way to search a vim buffer and has been for probably 30 years. But telescope gives me fuzzy finding and fuzzy finding might be nice in the current buffer.

<!-- TODO Link to commit 91dbabb -->

I'm adding `options.desc` to each binding, which makes them show up as explanatory text in which-key. They're a bit unsystematic though, so maybe I should try to make the mnemonics a bit more obvious.

<!-- TODO Link to commit c173b6e -->

Hmm, I don't _love_ them, but it'll do for now.

Having a fuzzy buffer picker is suprisingly handy:

<!-- TODO Link to commit 8cf7bcc -->

Maybe I'd like to search for keymaps as well? I've never used this but hopefully I can start.

<!-- TODO Link to commit 0924a23 -->

And fuzzy-searching vim help documents might be really useful. Again, not something I've used before but hopefully I can train myself to start.

<!-- TODO Link to commit efcb328 -->

This one I've used a bunch when I remember it, but I need more practice. `*` searches the current buffer for the word under the cursor, this will search the current directory (and children) for the same.

<!-- TODO Link to commit ae240ec -->

Another not-used-enough vim tools is the ShaDa ("shared data") file, including a list of recently opened files (files that have marks stored). You can get to it with `:oldfiles` (or just `:o`), but telescope has an extension for it.

<!-- TODO Link to commit 9f6efe8 -->

Searching through available commands will be great until I figure out bindings for them:

<!-- TODO Link to commit b6c075e -->

And searching through the command history as well. I might need to adjust the timeouts on this if it's too slow (because I've got two very similar bindings: `f:` and `f:h`, so when I type `f:` I need to wait for neovim to decide I'm not going to type an `h`).

<!-- TODO Link to commit f800f30 -->

Searching my search history is a lot better than typing `/` and then smashing the up arrow key a hundred times.

<!-- TODO Link to commit 488b5d5 -->

Ooh, this is a really interesting one. Search through the list of vim marks. That'll make a nice change to pressing `<Ctrl>+o` and `<Ctrl>+i` n times.

<!-- TODO Link to commit dc81c2e -->

There are a fair number of other telescope things (the quickfix one might be good once I get better at using the quickfix list) but I think I'm good for now.

## Completion

Completion is done via [nvim-cmp](https://github.com/hrsh7th/nvim-cmp), it shows a nice dropdown of possible completions, has **lots** of sources for the engine and the bindings are very configurable. It's just the standard at the moment.

Completion configuration is going in a directory called `completion` in `plugins`.

<!-- TODO Link to commit 5e49d59 -->

nvim-cmp needs "sources" turned on, places to look at for potential completion information. The basic one is strings inside the current vim buffer:

<!-- TODO Link to commit a33d820 -->

<!-- TODO Insert image 36-cmp_buffer_sources.png -->

The `path` source is great; it's looking at the local filesystem relative to the working directory. It does mean that you're more encouraged to open vim at the top-level of the project directory, but telescope makes opening files inside of neovim really easy, so it's not a hardship.

`cmp` is working nicely, but I don't think I want the completion to popup after a single character, there's too many false positives. Fortunately, that's configurable - only show me completions if 3 or more characters match:

<!-- TODO Link to commit 2104668 -->

# References

- [echasnovski/mini.nvim: Library of 40+ independent Lua modules improving overall Neovim (version 0.8 and higher) experience with minimal effort](https://github.com/echasnovski/mini.nvim)
- [nvim-telescope/telescope.nvim: Find, Filter, Preview, Pick. All lua, all the time.](https://github.com/nvim-telescope/telescope.nvim)
- [Repeat - Neovim docs](https://neovim.io/doc/user/repeat.html#_single-repeats)
- [BurntSushi/ripgrep: ripgrep recursively searches directories for a regex pattern while respecting your gitignore](https://github.com/BurntSushi/ripgrep)
- [sharkdp/fd: A simple, fast and user-friendly alternative to 'find'](https://github.com/sharkdp/fd)
- [hrsh7th/nvim-cmp: A completion plugin for neovim coded in Lua.](https://github.com/hrsh7th/nvim-cmp)
